<html>
<head>
    <title>2018 Q2 Ingress Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Coda|Exo|Exo+2|Roboto|Roboto+Mono" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <style>
        body{
            background-color: black;
            color: white;
            font-family: 'Coda', cursive;
        }
        div#chartContainer{
            background-color: black;
        }
        .heading, .subheading{

            color: white;
        }
        section.content{
            margin-left: 40px;
            float: left;
            border: solid 1.2px #59fbea;
            width: 45vw;
        }
        footer.bottom{
            position: fixed;
            left: 0;
            bottom: 10;
            width: 100%;
            color: white;
            text-align: center;
        }
        a:link{
            color: #59fbea;
        }
        .row-centered {
            text-align:center;
        }
        .col-centered {
            display:inline-block;
            float:none;
            /* reset the text-align */
            text-align:left;
            /* inline-block space fix */
            margin-right:-4px;
        }
        div.chartHolder{
            margin-bottom: 20px;
            margin-top: 20px;
        }
    </style>

</head>
<body>
<center>
    <h1 class="heading">Q2 2018 Unofficial Ingress Survey (Alpha)</h1>
    <h2 class="subheading"><span style="color:red;">Note:</span> This site is currently a work in progress. I will continue adding more charts and statistics.</h2>
    <h2 class="subheading"><a href="https://goo.gl/forms/QqlF8plcYIte4vKu1">Take the survey</a></h2>
    <h3 class="subheading" id="responses"></h3>
    <br>
    <div class="container-fluid">
        <div class="row row-centered">
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Which Faction?</h3></center>
                <canvas id="factionChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>What level are you?</h3></center>
                <canvas id="levelChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Do You Use IITC?</h3></center>
                <canvas id="IITCChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Mobile Device</h3></center>
                <canvas id="deviceChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Have you attended an Anomaly?</h3></center>
                <canvas id="anomalyChart" width="700" height="385"></canvas>
            </div>
        </div>
    </div>

    <footer class="bottom">
        Not officially affiliated with Ingress or Niantic Labs.<style>.heart{color:#e25555;}</style>
        Made with <span class="heart">&hearts;</span> in Dallas TX
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script>
        var jsonData;
        $(document).ready(function(){
            $.get('https://docs.google.com/spreadsheets/d/e/2PACX-1vRiJXhV13vGxD8OrxTrgmwhHzsSTEd_Oao2V2Ufalr88aOqUMO_N9IAv1Hg1xbStZiIIC2YopZRUQMO/pub?output=csv', function( data ){
                jsonData = JSON.parse(CSV2JSON(data));
                $('h3.subheading#responses').text("Currently " +jsonData.length + " Responses");
                //console.dir(jsonData);
                var factionChart = new Chart($('canvas#factionChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputeFactionRatio(jsonData),
                            backgroundColor: [
                                "#00c2ff",
                                "#28f428"
                            ]
                        }],
                        labels: [
                            'Resistance',
                            'Enlightened'
                        ]

                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        }
                    }
                });
                var levelChart = new Chart($('canvas#levelChart'), {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: ComputeLevelRatio(jsonData),
                            backgroundColor: [
                                "#fece5a",
                                "#ffa630",
                                "#ff7315",
                                "#e40000",
                                "#fd2992",
                                "#eb26cd",
                                "#c124e0",
                                "#9627f4",
                                "#353b48",
                                "#dcdde1"
                            ]
                        }],
                        labels: [
                            "1",
                            "2",
                            "3",
                            "4",
                            "5",
                            "6",
                            "7",
                            "8",
                            "9-15",
                            "16"
                        ]
                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        },
                        rotation: Math.PI
                    }
                });
                var IITCChart = new Chart($('canvas#IITCChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputeIITCRatio(jsonData),
                            backgroundColor: [
                                "#ecf0f1",
                                "#34495e"
                            ]
                        }],
                        labels: [
                            'Yes',
                            'No'
                        ]

                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        }
                    }
                });
                var deviceChart = new Chart($('canvas#deviceChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputeDeviceRatio(jsonData),
                            backgroundColor: [
                                "#33d9b2",
                                "#218c74",
                                "#706fd3",
                                "#474787",
                                "#f7f1e3"
                            ]
                        }],
                        labels: [
                            'Android Phone',
                            'Android Tablet',
                            'iPhone',
                            'iPad',
                            'Other'
                        ]

                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        }
                    }
                });
                var anomalyChart = new Chart($('canvas#anomalyChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputeAnomalyRatio(jsonData),
                            backgroundColor: [
                                "#1B9CFC",
                                "#B33771"
                            ]
                        }],
                        labels: [
                            'Yes',
                            'No'
                        ]
                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        },
                        rotation: Math.PI
                    }
                });
            });

        });
        function CSVToArray(strData, strDelimiter) {
            // Check to see if the delimiter is defined. If not,
            // then default to comma.
            strDelimiter = (strDelimiter || ",");
            // Create a regular expression to parse the CSV values.
            var objPattern = new RegExp((
                // Delimiters.
                "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
                // Quoted fields.
                "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
                // Standard fields.
                "([^\"\\" + strDelimiter + "\\r\\n]*))"), "gi");
            // Create an array to hold our data. Give the array
            // a default empty first row.
            var arrData = [[]];
            // Create an array to hold our individual pattern
            // matching groups.
            var arrMatches = null;
            // Keep looping over the regular expression matches
            // until we can no longer find a match.
            while (arrMatches = objPattern.exec(strData)) {
                // Get the delimiter that was found.
                var strMatchedDelimiter = arrMatches[1];
                // Check to see if the given delimiter has a length
                // (is not the start of string) and if it matches
                // field delimiter. If id does not, then we know
                // that this delimiter is a row delimiter.
                if (strMatchedDelimiter.length && (strMatchedDelimiter != strDelimiter)) {
                    // Since we have reached a new row of data,
                    // add an empty row to our data array.
                    arrData.push([]);
                }
                // Now that we have our delimiter out of the way,
                // let's check to see which kind of value we
                // captured (quoted or unquoted).
                if (arrMatches[2]) {
                    // We found a quoted value. When we capture
                    // this value, unescape any double quotes.
                    var strMatchedValue = arrMatches[2].replace(
                        new RegExp("\"\"", "g"), "\"");
                } else {
                    // We found a non-quoted value.
                    var strMatchedValue = arrMatches[3];
                }
                // Now that we have our value string, let's add
                // it to the data array.
                arrData[arrData.length - 1].push(strMatchedValue);
            }
            // Return the parsed data.
            return (arrData);
        }
        function CSV2JSON(csv) {
            var array = CSVToArray(csv);
            var objArray = [];
            for (var i = 1; i < array.length; i++) {
                objArray[i - 1] = {};
                for (var k = 0; k < array[0].length && k < array[i].length; k++) {
                    var key = array[0][k];
                    objArray[i - 1][key] = array[i][k]
                }
            }

            var json = JSON.stringify(objArray);
            var str = json.replace(/},/g, "},\r\n");

            return str;
        }
        function ComputeFactionRatio(jsonData){

            var factions = {"r" : 0, "e" : 0};
            jsonData.forEach(function(items){
                if(items["What faction do you play for?"] === "Resistance"){
                    factions.r++;
                }else{
                    factions.e++;
                }
            });
            var total = factions.r + factions.e;
            var results = [];
            results.push(Number.parseFloat(factions.r / total * 100).toPrecision(2));
            results.push(Number.parseFloat(100 - (factions.r / total * 100)).toPrecision(2));
            return results;
        }
        function ComputeLevelRatio(jsonData) {
            var responses = new Array(10);
            responses.fill(0);
            jsonData.forEach(function(items){
                var level = parseInt(items["What is your current level?"].substring(1));
                if(8 < level && level < 16){
                    responses[8]++;
                }else if(level === 16){
                    responses[9]++;
                }else{
                    responses[level - 1]++;
                }


            });
            var total = responses.reduce(function(acc, val) { return acc + val; });
            console.log(total);
            var results = [];
            responses.forEach(function(items){
               results.push(parseFloat(items / total * 100).toPrecision(2));
            });
            console.dir(results);
            return results;

        }
        function ComputeIITCRatio(jsonData) {
            var responses = {y: 0, n: 0};
            jsonData.forEach(function(items){
                if(items["Do you use IITC?"] === "Yes"){
                    responses.y++;
                }else{
                    responses.n++;
                }
            });
            var total = responses.y + responses.n;
            var results = [];
            results.push(Number.parseFloat(responses.y / total * 100).toPrecision(2));
            results.push(Number.parseFloat(100 - (responses.y / total * 100)).toPrecision(2));
            return results;

        }
        function ComputeDeviceRatio(jsonData) {
            var responses = {aphone: 0, iphone: 0, atablet: 0, ipad: 0, other: 0};
            jsonData.forEach(function(items){
                switch (items["What kind of device do you play the most often on?"]){
                    case "Android Phone":
                        responses.aphone++;
                        break;
                    case "iPhone":
                        responses.iphone++;
                        break;
                    case "iPad":
                        responses.ipad++;
                        break;
                    case "Android Tablet":
                        responses.atablet++;
                        break;
                    default:
                        responses.other++;
                        break;
                }
            });
            var total = responses.aphone + responses.atablet + responses.iphone + responses.ipad + responses.other;
            var results = [];
            results.push(Number.parseFloat(responses.aphone / total * 100).toPrecision(2));
            results.push(Number.parseFloat(responses.atablet / total * 100).toPrecision(2));
            results.push(Number.parseFloat(responses.iphone / total * 100).toPrecision(2));
            results.push(Number.parseFloat(responses.ipad / total * 100).toPrecision(2));
            results.push(Number.parseFloat(responses.other / total * 100).toPrecision(2));
            return results;

        }
        function ComputeAnomalyRatio(jsonData) {
            var responses = {y: 0, n: 0};
            jsonData.forEach(function(items){
                if(items["Have you attended an anomaly?"] === "Yes"){
                    responses.y++;
                }else{
                    responses.n++;
                }
            });
            var total = responses.y + responses.n;
            var results = [];
            results.push(Number.parseFloat(responses.y / total * 100).toPrecision(2));
            results.push(Number.parseFloat(100 - (responses.y / total * 100)).toPrecision(2));
            return results;
        }

    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41144170-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-41144170-2');
    </script>
</body>
</html>
