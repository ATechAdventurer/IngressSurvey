<html>
<head>
    <title>2018 Q2 Ingress Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Coda|Exo|Exo+2|Roboto|Roboto+Mono" rel="stylesheet">
    <link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA760A2++tANsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADoqgAh764A/u6tAP/urQD/764A/uiqACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAmAAHvrgD+7q4A//ruy//+/v3//v79//z24//10XH/8K8B/kAmAAEAAAAAAAAAAAAAAAAAAAAAAAAAAO+uAPzvrgD/77MV//7+/f/urQL/7awA/+2sAP/00XP//v7+//XVf//10HH/764A/AAAAAAAAAAAAAAAAPKwAP/urQL//f39//C+N//vrgD/764A//789//+/Pf/9tN1//bTdf/225D//v39//XSdP/yrgD/AAAAAAAAAADysAD//v37//7+/f/tqwD/764A/++wBf/57Mj/+evG//bUef/203X/9M9t//7////+/v3/8q8A/wAAAAAAAAAA8rAA//79+//urQH/77QY/+2sAP/+/vz/7qsA/+6rAP/+/v3/9dFz//XXhf/00nT//v79//KvAP8AAAAAAAAAAPKwAP/+/fv/7q0B/++uAP/utR3/7q4O/+2qAP/tqwH/9dJ2//XWgf/203X/9dJ0//7+/f/yrwD/AAAAAAAAAADysAD//v37/+6tAf/trAD//v38//jhov/9/fr//f36//ruzf/+/fz/9NFz//XSdP/+/v3/8q8A/wAAAAAAAAAA8rAA//79+//urQH/+erB///////tpwD/8Lww//XOZv/0z2r///////vz3f/10nT//v79//KvAP8AAAAAAAAAAPKwAP/+/fv/7q0B/+6pAP/uqQD/9NBu//XQbf/10G3/9dBt//XQbf/10G3/9dJ0//7+/f/yrwD/AAAAAAAAAADysAD/7q0C//39/f/wvTf/9dJ0//bTdf/00XH/9NFw//bTdf/203X/9tuQ//79/v/10nT/8q4A/wAAAAAAAAAAAAAAAO+uAPzurQP/9dV///7+/v/10XT/9dFx//XRcP/10XT//v7+//XVf//yyl3/764A/AAAAAAAAAAAAAAAAAAAAAAAAAAAQCYAAe+uAv710nL//PXj//7+/v/+/v7//Pbk//bTdP/vrQD+QCYAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6aUAIu6sAP7203X/9dJ0/+6sAP7oqgAhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA760A2u+tANsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/n8AAPw/AADwDwAAwAMAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAwAMAAPAPAAD8PwAA/n8AAA==" rel="icon" type="image/x-icon" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <style>
        body{
            background-color: black;
            color: white;
            font-family: 'Coda', cursive;
        }
        div#chartContainer{
            background-color: black;
        }
        .heading, .subheading{

            color: white;
        }
        section.content{
            margin-left: 40px;
            float: left;

            width: 45vw;
        }
        footer.bottom{
            position: fixed;
            left: 0;
            bottom: 10;
            width: 100%;
            color: white;
            text-align: center;
        }
        a:link{
            color: #59fbea;
        }
        .row-centered {
            text-align:center;
        }
        .col-centered {
            display:inline-block;
            float:none;
            /* reset the text-align */
            text-align:left;
            /* inline-block space fix */
            margin-right:-4px;
        }
        div.chartHolder{
            border: solid 1.2px #59fbea;
            padding-bottom: 20px;
            padding-top: 20px;
        }
    </style>

</head>
<body>
<center>
    <h1 class="heading">Q2 2018 Unofficial Ingress Survey (Alpha)</h1>
    <h2 class="subheading"><span style="color:red;">Note:</span> This site is currently a work in progress. I will continue adding more charts and statistics.</h2>
    <h2 class="subheading"><a href="https://goo.gl/forms/QqlF8plcYIte4vKu1">Take the survey</a></h2>
    <h3 class="subheading" id="responses"></h3>
    <br>
    <div class="container-fluid">
        <div class="row row-centered">
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Which Faction?</h3></center>
                <canvas id="factionChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>What level are you?</h3></center>
                <canvas id="levelChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Do You Use IITC?</h3></center>
                <canvas id="IITCChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Mobile Device</h3></center>
                <canvas id="deviceChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Have you attended an Anomaly?</h3></center>
                <canvas id="anomalyChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Do you play Pokemon Go?</h3></center>
                <canvas id="pokemonChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>How do you get around?</h3></center>
                <canvas id="travelChart" width="700" height="385"></canvas>
            </div>
            <div class="chartHolder col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <center><h3>Do you keep up with the storyline?</h3></center>
                <canvas id="storyLineChart" width="700" height="385"></canvas>
            </div>
        </div>
    </div>

    <footer class="bottom">
        Not officially affiliated with Ingress or Niantic Labs.<style>.heart{color:#e25555;}</style>
        Made with <span class="heart">&hearts;</span> in Dallas TX
        <a href="https://github.com/ATechAdventurer/IngressSurvey/issues">Report an Issue</a>
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script>
        var jsonData;
        $(document).ready(function() {
            $.get('https://docs.google.com/spreadsheets/d/e/2PACX-1vRiJXhV13vGxD8OrxTrgmwhHzsSTEd_Oao2V2Ufalr88aOqUMO_N9IAv1Hg1xbStZiIIC2YopZRUQMO/pub?output=csv', function (data) {
                jsonData = JSON.parse(CSV2JSON(data));
                $('h3.subheading#responses').text("Currently " + jsonData.length + " Responses");
                //console.dir(jsonData);
                var factionChart = new Chart($('canvas#factionChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputeFactionRatio(jsonData),
                            backgroundColor: [
                                "#00c2ff",
                                "#28f428"
                            ]
                        }],
                        labels: [
                            'Resistance',
                            'Enlightened'
                        ]

                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        }
                    }
                });
                var levelChart = new Chart($('canvas#levelChart'), {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: ComputeLevelRatio(jsonData),
                            backgroundColor: [
                                "#fece5a",
                                "#ffa630",
                                "#ff7315",
                                "#e40000",
                                "#fd2992",
                                "#eb26cd",
                                "#c124e0",
                                "#9627f4",
                                "#353b48",
                                "#dcdde1"
                            ]
                        }],
                        labels: [
                            "1",
                            "2",
                            "3",
                            "4",
                            "5",
                            "6",
                            "7",
                            "8",
                            "9-15",
                            "16"
                        ]
                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        },
                        rotation: Math.PI
                    }
                });
                var IITCChart = new Chart($('canvas#IITCChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputeIITCRatio(jsonData),
                            backgroundColor: [
                                "#ecf0f1",
                                "#34495e"
                            ]
                        }],
                        labels: [
                            'Yes',
                            'No'
                        ]

                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        }
                    }
                });
                var deviceChart = new Chart($('canvas#deviceChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputeDeviceRatio(jsonData),
                            backgroundColor: [
                                "#33d9b2",
                                "#218c74",
                                "#706fd3",
                                "#474787",
                                "#f7f1e3"
                            ]
                        }],
                        labels: [
                            'Android Phone',
                            'Android Tablet',
                            'iPhone',
                            'iPad',
                            'Other'
                        ]

                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        }
                    }
                });
                var anomalyChart = new Chart($('canvas#anomalyChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputeAnomalyRatio(jsonData),
                            backgroundColor: [
                                "#1B9CFC",
                                "#B33771"
                            ]
                        }],
                        labels: [
                            'Yes',
                            'No'
                        ]
                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        },
                        rotation: Math.PI
                    }
                });
                var PokemonGoChart = new Chart($('canvas#pokemonChart'), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: ComputePokemonGoRatio(jsonData),
                            backgroundColor: [
                                "#ee1515",
                                "#f0f0f0"
                            ]
                        }],
                        labels: [
                            'Yes',
                            'No'
                        ]
                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        },
                        rotation: Math.PI
                    }
                });
                var TransportationChart = new Chart($('canvas#travelChart'), {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: TransportationRatio(jsonData),
                            backgroundColor: [
                                "#3CB371",
                                "#EEE8AA",
                                "#FF69B4",
                                "#BC8F8F",
                                "#FF6347",
                                "#ADD8E6",
                                "#8B008B",
                                "#4169E1"
                            ]
                        }],
                        labels: [
                            "Walking",
                            "Public Transportation",
                            "Car",
                            "Bike",
                            "Rideshare ",
                            "Skates",
                            "Motorcycle",
                            "Other"
                        ]

                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        }
                    }
                });
                var StoryLineChart = new Chart($('canvas#storyLineChart'), {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: ComputeYNRatio(jsonData, "Have you kept up with the Ingress story-line?"),
                            backgroundColor: [
                                "#3CB371",
                                "#EEE8AA",
                            ]
                        }],
                        labels: [
                            "Yes",
                            "No"
                        ]
                    },
                    options: {
                        legend: {
                            labels: {
                                fontColor: 'white'
                            }
                        }
                    }
                });

            });

            function CSVToArray(strData, strDelimiter) {
                strDelimiter = (strDelimiter || ",");
                var objPattern = new RegExp((
                    "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
                    "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
                    "([^\"\\" + strDelimiter + "\\r\\n]*))"), "gi");
                var arrData = [[]];
                var arrMatches = null;
                while (arrMatches = objPattern.exec(strData)) {
                    var strMatchedDelimiter = arrMatches[1];
                    if (strMatchedDelimiter.length && (strMatchedDelimiter != strDelimiter)) {
                        arrData.push([]);
                    }
                    if (arrMatches[2]) {
                        var strMatchedValue = arrMatches[2].replace(
                            new RegExp("\"\"", "g"), "\"");
                    } else {
                        var strMatchedValue = arrMatches[3];
                    }
                    arrData[arrData.length - 1].push(strMatchedValue);
                }
                return (arrData);
            }

            function CSV2JSON(csv) {
                var array = CSVToArray(csv);
                var objArray = [];
                for (var i = 1; i < array.length; i++) {
                    objArray[i - 1] = {};
                    for (var k = 0; k < array[0].length && k < array[i].length; k++) {
                        var key = array[0][k];
                        objArray[i - 1][key] = array[i][k]
                    }
                }
                var json = JSON.stringify(objArray);
                var str = json.replace(/},/g, "},\r\n");
                return str;
            }

            function ComputeFactionRatio(jsonData) {
                var factions = {"r": 0, "e": 0};
                jsonData.forEach(function (items) {
                    if (items["What faction do you play for?"] === "Resistance") {
                        factions.r++;
                    } else {
                        factions.e++;
                    }
                });
                var total = factions.r + factions.e;
                var results = [];
                results.push(Number.parseFloat(factions.r / total * 100).toPrecision(2));
                results.push(Number.parseFloat(100 - (factions.r / total * 100)).toPrecision(2));
                return results;
            }

            function ComputeYNRatio(jsonData, key) {
                var responses = {y: 0, n: 0};
                jsonData.forEach(function (items) {
                    if (items[key] === "Yes") {
                        responses.y++;
                    } else {
                        responses.n++;
                    }
                });
                var total = responses.y + responses.n;
                var results = [];
                results.push(Number.parseFloat(responses.y / total * 100).toPrecision(2));
                results.push(Number.parseFloat(100 - (responses.y / total * 100)).toPrecision(2));
                return results;
            }

            function ComputeLevelRatio(jsonData) {
                var responses = new Array(10);
                responses.fill(0);
                jsonData.forEach(function (items) {
                    var level = parseInt(items["What is your current level?"].substring(1));
                    if (8 < level && level < 16) {
                        responses[8]++;
                    } else if (level === 16) {
                        responses[9]++;
                    } else {
                        responses[level - 1]++;
                    }


                });
                var total = responses.reduce(function (acc, val) {
                    return acc + val;
                });
                console.log(total);
                var results = [];
                responses.forEach(function (items) {
                    results.push(parseFloat(items / total * 100).toPrecision(2));
                });
                console.dir(results);
                return results;

            }

            function ComputeIITCRatio(jsonData) {
                var responses = {y: 0, n: 0};
                jsonData.forEach(function (items) {
                    if (items["Do you use IITC?"] === "Yes") {
                        responses.y++;
                    } else {
                        responses.n++;
                    }
                });
                var total = responses.y + responses.n;
                var results = [];
                results.push(Number.parseFloat(responses.y / total * 100).toPrecision(2));
                results.push(Number.parseFloat(100 - (responses.y / total * 100)).toPrecision(2));
                return results;

            }

            function ComputeDeviceRatio(jsonData) {
                var responses = {aphone: 0, iphone: 0, atablet: 0, ipad: 0, other: 0};
                jsonData.forEach(function (items) {
                    switch (items["What kind of device do you play the most often on?"]) {
                        case "Android Phone":
                            responses.aphone++;
                            break;
                        case "iPhone":
                            responses.iphone++;
                            break;
                        case "iPad":
                            responses.ipad++;
                            break;
                        case "Android Tablet":
                            responses.atablet++;
                            break;
                        default:
                            responses.other++;
                            break;
                    }
                });
                var total = responses.aphone + responses.atablet + responses.iphone + responses.ipad + responses.other;
                var results = [];
                results.push(Number.parseFloat(responses.aphone / total * 100).toPrecision(2));
                results.push(Number.parseFloat(responses.atablet / total * 100).toPrecision(2));
                results.push(Number.parseFloat(responses.iphone / total * 100).toPrecision(2));
                results.push(Number.parseFloat(responses.ipad / total * 100).toPrecision(2));
                results.push(Number.parseFloat(responses.other / total * 100).toPrecision(2));
                return results;

            }

            function ComputeAnomalyRatio(jsonData) {
                var responses = {y: 0, n: 0};
                jsonData.forEach(function (items) {
                    if (items["Have you attended an anomaly?"] === "Yes") {
                        responses.y++;
                    } else {
                        responses.n++;
                    }
                });
                var total = responses.y + responses.n;
                var results = [];
                results.push(Number.parseFloat(responses.y / total * 100).toPrecision(2));
                results.push(Number.parseFloat(100 - (responses.y / total * 100)).toPrecision(2));
                return results;
            }

            function ComputePokemonGoRatio(jsonData) {
                var responses = {y: 0, n: 0};
                jsonData.forEach(function (items) {
                    if (items["Do you play Pokemon Go?"] === "Yes") {
                        responses.y++;
                    } else {
                        responses.n++;
                    }
                });
                var total = responses.y + responses.n;
                var results = [];
                results.push(Number.parseFloat(responses.y / total * 100).toPrecision(2));
                results.push(Number.parseFloat(100 - (responses.y / total * 100)).toPrecision(2));
                console.dir(results);
                return results;
            }

            function TransportationRatio(jsonData) {
                var responses = {w: 0, pt: 0, c: 0, b: 0, rs: 0, skate: 0, motor: 0, other: 0};
                jsonData.forEach(function (items) {
                    switch (items["How do you most often get around while playing?"]) {
                        case "Walking":
                            responses.w++;
                            break;
                        case "Public Transportation":
                            responses.pt++;
                            break;
                        case "Car":
                            responses.c++;
                            break;
                        case "Bicycle":
                            responses.b++;
                            break;
                        case "Taxi / Uber / Lyft":
                            responses.rs++;
                            break;
                        case "Skateboard, Scooter, Rollerblades":
                            responses.skate++;
                            break;
                        case "Motorcycle":
                            responses.motor++;
                            break;
                        default:
                            responses.other++;
                            break;
                    }
                });
                var total = responses.w + responses.pt + responses.c + responses.b + responses.rs + responses.skate + responses.motor + responses.other;
                var results = [];
                //results.push(Number.parseFloat(responses.y / total * 100).toPrecision(2));
                //results.push(Number.parseFloat(100 - (responses.y / total * 100)).toPrecision(2));
                results.push(responses.w);
                results.push(responses.pt);
                results.push(responses.c);
                results.push(responses.b);
                results.push(responses.rs);
                results.push(responses.skate);
                results.push(responses.motor);
                results.push(responses.other);
                console.dir(results);
                return results;
            }
        });

    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41144170-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-41144170-2');
    </script>
</body>
</html>
